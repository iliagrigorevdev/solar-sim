#extension GL_OES_standard_derivatives : enable
precision highp float;

uniform vec2 u_resolution;
uniform int u_num_bodies;

#define MAX_BODIES 100
uniform vec2 u_body_positions[MAX_BODIES];
uniform float u_body_radii[MAX_BODIES];

uniform float u_initialization_radius;
uniform float u_zoom;

// Функция знакового расстояния для круга
float sdCircle(vec2 p, float r) {
    return length(p) - r;
}

void main() {
    float resolution = min(u_resolution.x, u_resolution.y);
    vec2 uv = (gl_FragCoord.xy * 2.0 - u_resolution.xy) / resolution;
    uv /= u_zoom;

    float total_color = 0.0;

    for (int i = 0; i < MAX_BODIES; i++) {
        if (i >= u_num_bodies) break;

        // Масштабируем позицию и радиус
        vec2 scaled_pos = u_body_positions[i] / u_initialization_radius;
        float scaled_radius = max(u_body_radii[i] / u_initialization_radius, 2.0 / (resolution * u_zoom));

        float dist = sdCircle(uv - scaled_pos, scaled_radius);
        
        // Используем fwidth для сглаживания, которое адаптируется к масштабу
        float edge_width = fwidth(dist);
        total_color += 1.0 - smoothstep(-edge_width, edge_width, dist);
    }

    gl_FragColor = vec4(vec3(total_color), 1.0);
}
attribute vec2 a_position;

void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
}